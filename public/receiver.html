<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8"/>
  <title>Receiver Dashboard</title>
  <style> /* same styling as before */ </style>
</head>
<body>
  <h1>Welcome, <span id="userName"></span></h1>
  <button onclick="logout()">Log Out</button>
  <h2>Create New Task</h2>
  <input id="taskDesc" placeholder="Task description" />
  <input id="taskPay"  placeholder="Payment amount" />
  <button onclick="createTask()">Create Task</button>
  <hr/>
  <h2>Available Tasks</h2>
  <div id="tasksContainer"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const user = JSON.parse(localStorage.getItem('user')||'null');
    if (!user || user.role!=='receiver') window.location='index.html';
    document.getElementById('userName').innerText = user.username;

    async function createTask() {
      const desc = document.getElementById('taskDesc').value;
      const pay  = document.getElementById('taskPay').value;
      const res = await fetch('/api/task', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ description: desc, payment: pay })
      });
      const j = await res.json();
      if (!j.success) return alert(j.message);
      alert('Task created: ' + j.task.id);
      loadTasks();
    }

    async function loadTasks() {
      const res = await fetch('/api/tasks');
      const j   = await res.json();
      const c   = document.getElementById('tasksContainer');
      c.innerHTML = '';
      j.tasks.forEach(t => {
        c.innerHTML += `
          <div>
            <strong>#${t.id}</strong> ${t.description}
            ($${t.payment}) â€“ ${t.status}
          </div>`;
      });
    }

    function logout() {
      fetch('/api/logout', { method:'POST' })
        .then(_=>{ localStorage.removeItem('user'); window.location='index.html'; });
    }

    loadTasks();
    const socket = io();
    socket.on('taskCreated', loadTasks);
    socket.on('taskUpdated', loadTasks);
  </script>
</body>
</html>